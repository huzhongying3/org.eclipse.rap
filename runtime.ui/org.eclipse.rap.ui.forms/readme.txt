Based on code from dev.eclipse.org:/cvsroot/eclipse, v20100226